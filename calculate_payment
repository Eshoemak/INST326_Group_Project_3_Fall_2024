import calendar
import random

# Define constants
HOURLY_RATE = 20  # $20/hour

def schedule_generation(staff, year, month):
    # Define shifts
    shifts = ["7:00AM - 1:00PM", "1:00PM - 7:00PM"]

    # Get number of days
    day_count = calendar.monthrange(year, month)[1]

    # Shift assignment
    schedule = {}
    for day in range(1, day_count + 1):
        schedule[day] = {
            shifts[0]: random.choice(staff), 
            shifts[1]: random.choice(staff)
        }

    return schedule

def display_schedule_as_html(schedule, year, month):
    # Create the calendar object
    cal = calendar.HTMLCalendar()
    html_calendar = cal.formatmonth(year, month)

    # Embed shifts into the calendar
    html_calendar = html_calendar.replace(
        "<table", '<table border="1" cellpadding="5" cellspacing="0"'
    )
    for day, shifts in schedule.items():
        shift_info = "<br>".join(f"{time}: {person}" for time, person in shifts.items())
        html_calendar = html_calendar.replace(
            f'>{day}<',
            f' bgcolor="#FFD700">{day}<br>{shift_info}<'
        )

    # Write the HTML to a file
    with open("schedule.html", "w") as file:
        file.write(html_calendar)

    print("Schedule has been successfully saved as 'schedule.html'!")

def calculate_payment(schedule, staff, hours_per_shift=6):
    # Initialize payment dictionary
    payments = {person: 0 for person in staff}
    total_weekly_hours = 0

    # Iterate over the schedule to calculate hours and pay
    for day_shifts in schedule.values():
        for shift, person in day_shifts.items():
            payments[person] += hours_per_shift
            total_weekly_hours += hours_per_shift

    # Calculate gross weekly pay and monthly projection
    weekly_gross_pay = {person: payments[person] * HOURLY_RATE for person in payments}
    total_weekly_gross = sum(weekly_gross_pay.values())
    total_monthly_gross = total_weekly_gross * 4  # Approximate 4 weeks in a month

    # Generate the report text
    report = "Caregiver Weekly Payment Report\n"
    report += "--------------------------------\n"
    for person, pay in weekly_gross_pay.items():
        report += f"{person}: ${pay:.2f} (Weekly Hours: {payments[person]})\n"
    report += "--------------------------------\n"
    report += f"Total Weekly Gross Pay: ${total_weekly_gross:.2f}\n"
    report += f"Projected Monthly Gross Pay: ${total_monthly_gross:.2f}\n"

    # Write the report to a text file
    with open("payment_report.txt", "w") as file:
        file.write(report)

    print("Payment report has been successfully generated and saved as 'payment_report.txt'!")

# Sample list of people to assign
staff = ["Emily", "Andrew", "Jaylen", "Christopher", "Peter", "Chris", "Brian"]

# Get user input for the year and month
year = int(input("Enter the year: "))
month = int(input("Enter the month (1-12): "))

# Generate the work schedule
schedule = schedule_generation(staff, year, month)

# Display the schedule as an HTML calendar
display_schedule_as_html(schedule, year, month)

# Calculate and generate the payment report
calculate_payment(schedule, staff)
